# Proxy Configuration Scraper and Scorer

## Описание

Этот скрипт на Python предназначен для автоматического сбора, проверки и оценки конфигураций прокси-серверов из различных онлайн источников. Он разработан для поиска и сохранения рабочих и качественных конфигураций протоколов `vless://`, `tuic://` и `hy2://`. Скрипт оценивает конфигурации на основе множества параметров, таких как безопасность, производительность и сложность настроек, и сохраняет только те, которые соответствуют заданным критериям качества.

## Функциональность

*   **Сбор конфигураций:** Загрузка содержимого с URL-адресов, указанных в файле `all_urls.txt`, в поисках строк, похожих на конфигурации прокси.
*   **Поддержка протоколов:** Работает с протоколами `vless://`, `tuic://` и `hy2://`.
*   **Валидация URL:** Проверяет корректность и формат URL-адресов источников.
*   **Удаление дубликатов:** Исключает повторяющиеся конфигурации прокси на основе заданных критериев.
*   **Скоринг конфигураций:** Оценивает каждую конфигурацию по комплексу параметров, включая безопасность, транспорт, шифрование, наличие SNI, ALPN, и другие, присваивая каждой конфигурации числовой рейтинг.
*   **Фильтрация по качеству:** Сохраняет только конфигурации, чей скоринг превышает минимально установленное значение (`MIN_ACCEPTABLE_SCORE`).
*   **Сохранение в файл:** Записывает отобранные конфигурации в файл `proxy_configs.txt`, с возможностью добавления пользовательского имени профиля.
*   **Статистика:** Предоставляет подробную статистику о процессе сбора и обработки конфигураций, включая количество обработанных каналов, найденных валидных и уникальных конфигураций, а также статистику по протоколам.

## Требования

*   Python 3.7 или выше
*   Библиотеки из стандартной библиотеки Python (asyncio, aiohttp, re, os, urllib, dataclasses, collections, logging, enum, shutil).

## Использование

1.  **Настройка источников:**
    *   Создайте файл `all_urls.txt` в корневой директории скрипта.
    *   Добавьте в `all_urls.txt` список URL-адресов, которые скрипт будет использовать для поиска конфигураций прокси (каждый URL с новой строки). Это могут быть URL-ы веб-страниц, текстовых файлов или других онлайн источников, содержащих конфигурации.
2.  **Запуск скрипта:**
    ```bash
    python script_name.py
    ```
    Замените `script_name.py` на имя вашего Python файла (например, если файл называется `proxy_fetcher.py`, команда будет `python proxy_fetcher.py`).
3.  **Просмотр результатов:**
    *   Валидные конфигурации будут сохранены в файле `configs/proxy_configs.txt`.
    *   Статистика работы скрипта будет выведена в консоль и в лог.

## Конфигурация

Основные параметры скрипта задаются непосредственно в коде в начале файла. Вы можете настроить:

*   `MIN_ACCEPTABLE_SCORE`: Минимальный приемлемый скоринг конфигурации для сохранения (по умолчанию 100.0).
*   `MIN_CONFIG_LENGTH`: Минимальная длина строки, считающейся потенциальной конфигурацией прокси (по умолчанию 40 символов).
*   `ALLOWED_PROTOCOLS`: Список поддерживаемых протоколов (`vless://`, `tuic://`, `hy2://`).
*   `OUTPUT_CONFIG_FILE`: Путь к файлу, в который будут сохранены рабочие конфигурации (`configs/proxy_configs.txt`).
*   `ALL_URLS_FILE`: Путь к файлу со списком URL-адресов источников (`all_urls.txt`).
*   `MAX_CONCURRENT_CHANNELS`: Максимальное количество каналов, обрабатываемых одновременно (для управления нагрузкой).
*   `REQUEST_TIMEOUT`: Общий таймаут для HTTP запросов к каналам (в секундах).
*   `HIGH_FREQUENCY_THRESHOLD_HOURS`: Временной порог в часах для бонуса за частоту успешных проверок канала.
*   `HIGH_FREQUENCY_BONUS`: Бонус к рейтингу канала за недавние успешные проверки.
*   `CHECK_USERNAME`, `CHECK_TLS_REALITY`, `CHECK_SNI`, `CHECK_CONNECTION_TYPE`: Флаги для включения/выключения проверок при создании ключа уникальности профиля (для фильтрации дубликатов).
*   `ScoringWeights`: Enum, определяющий веса различных параметров при скоринге конфигураций. Вы можете настроить веса, чтобы влиять на оценку различных характеристик конфигураций.

## Система скоринга

Скрипт использует систему скоринга для оценки качества каждой конфигурации прокси. Рейтинг формируется на основе различных параметров, таких как:

*   **Безопасность:** Тип безопасности (`tls`, `reality`), параметры безопасности.
*   **Транспорт:** Тип транспорта (`tcp`, `ws`, `quic`).
*   **Шифрование:** Тип шифрования (`none`, `auto`, `aes-128-gcm`, `chacha20-poly1305`).
*   **Параметры TLS:** Наличие и качество SNI, ALPN, TLS Fingerprint (UTLS).
*   **Производительность:** Размер буфера, оптимизация TCP, параметры QUIC.
*   **Обфускация и другие параметры:** Использование CDN, OBFS, наличие комментариев и отладочных параметров.

Веса каждого параметра задаются в классе `ScoringWeights`. Более высокие значения весов указывают на большее влияние параметра на общий рейтинг.

## Статистика

После завершения работы скрипт выводит в консоль и записывает в лог следующую статистику:

*   Общее количество обработанных каналов.
*   Количество включенных и отключенных каналов (в зависимости от валидности URL-адресов в `all_urls.txt`).
*   Общее количество найденных валидных конфигураций.
*   Общее количество уникальных конфигураций (после фильтрации дубликатов).
*   Количество успешных и неудачных загрузок контента с каналов.
*   Статистика по протоколам: количество найденных конфигураций для каждого протокола (`vless`, `tuic`, `hy2`).
*   Рейтинг каналов: список каналов, отсортированный по оценке стабильности, с указанием URL, количества валидных конфигураций, оценки стабильности, успехов и неудач.

Эта статистика помогает оценить эффективность работы скрипта и качество источников конфигураций.

[MIT License](https://rem.mit-license.org/)
